---
import BaseLayout from "../layouts/BaseLayout.astro";
import PublicationList from "../components/PublicationList.astro";
import { parseBibTeX } from "../lib/bibtex";
import bibRaw from "../../cv/sections/papers.bib?raw";
import { profile } from "../data/profile";

const publications = parseBibTeX(bibRaw);
const surname = profile.fullName.trim().split(/\s+/).slice(-1)[0]?.toLowerCase() ?? "";
const isFirstAuthor = (firstAuthor: string | undefined): boolean => {
  if (!firstAuthor || !surname) return false;
  return firstAuthor.toLowerCase().includes(surname);
};

const firstAuthorPapers = publications.filter(
  (pub) => pub.tags.some((tag) => tag.toLowerCase() === "mefirst") || isFirstAuthor(pub.authors[0])
);
const scholarUrl = profile.socials.googleScholar || "https://scholar.google.com/citations?user=rYjyXBQAAAAJ";
const adsUrl = "https://ui.adsabs.harvard.edu/search/q=orcid%3A0000-0002-4585-3985&sort=date+desc";
---

<BaseLayout
  title="Publications"
  description="First-author publications."
  canonicalPath="/publications"
>
  <section>
    <h1>Selected Publications</h1>
    <p>
      See <a href={scholarUrl}><u>Google Scholar</u></a> or <a href={adsUrl}><u>ADS library</u></a> for a full list.
    </p>
  </section>

  <section>
    {firstAuthorPapers.length > 0 ? (
      <PublicationList items={firstAuthorPapers} />
    ) : (
      <p>No first-author papers listed yet.</p>
    )}
  </section>
</BaseLayout>
