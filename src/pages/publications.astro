---
import BaseLayout from "../layouts/BaseLayout.astro";
import PublicationList from "../components/PublicationList.astro";
import { parseBibTeX } from "../lib/bibtex";
import bibRaw from "../../cv/sections/papers.bib?raw";
import { profile } from "../data/profile";

const publications = parseBibTeX(bibRaw);
const surname = profile.fullName.trim().split(/\s+/).slice(-1)[0]?.toLowerCase() ?? "";
const isFirstAuthor = (firstAuthor: string | undefined): boolean => {
  if (!firstAuthor || !surname) return false;
  return firstAuthor.toLowerCase().includes(surname);
};

const firstAuthorPapers = publications.filter(
  (pub) => pub.tags.some((tag) => tag.toLowerCase() === "mefirst") || isFirstAuthor(pub.authors[0])
);
const otherPapers = publications.filter(
  (pub) => !pub.tags.some((tag) => tag.toLowerCase() === "mefirst") && !isFirstAuthor(pub.authors[0])
);
---

<BaseLayout
  title="Publications"
  description="Peer-reviewed publications and selected preprints."
  canonicalPath="/publications"
>
  <section>
    <h1>Publications</h1>
    <p>
      Google Scholar:{" "}
      <a href={profile.socials.googleScholar || "https://scholar.google.com/citations?user=rYjyXBQAAAAJ"}>
        {profile.socials.googleScholar || "https://scholar.google.com/citations?user=rYjyXBQAAAAJ"}
      </a>
    </p>
  </section>

  <section>
    <h2>First-Author</h2>
    {firstAuthorPapers.length > 0 ? (
      <PublicationList items={firstAuthorPapers} />
    ) : (
      <p>No first-author papers listed yet.</p>
    )}
  </section>

  <section>
    <h2>Others</h2>
    {otherPapers.length > 0 ? <PublicationList items={otherPapers} /> : <p>No additional papers listed.</p>}
  </section>
</BaseLayout>
